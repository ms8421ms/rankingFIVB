<html>
  <head>
    <title>Calcolo ranking FIVB</title>
  </head>

<body>
	<h1>Calcolo ranking FIVB</h1>
<form method="GET">
    <label for="rankingS1">Ranking squadra A</label>
    <input id="rankingS1" name="rankingS1" type="number" placeholder="Inserisci ranking squadra 1">
    <br>
    <label for="rankingS2">Ranking squadra B</label>
    <input id="rankingS2" name="rankingS2" type="number" placeholder="Inserisci ranking squadra 2">
    <br>
    <label for="risultato">Risultato</label>
    <select id="risultato" name="risultato">
        <option value="1">3-0</option>
        <option value="2">3-1</option>
        <option value="3">3-2</option>
        <option value="4">2-3</option>
        <option value="5">1-3</option>
        <option value="6">0-3</option>
    </select>
    <label for="competizione">Competizione</label>
    <select id="competizione" name="competizione">
        <option value="1">Olimpiadi</option>
        <option value="2">Mondiali</option>
        <option value="3">Nations League</option>
        <option value="4">Qualificazione Olimpiadi</option>
        <option value="5">Coppa del Mondo</option>
        <option value="6">Tornei continentali</option>
        <option value="7">Challenger Cup</option>
        <option value="8">Qualificazione tornei continentali</option>
        <option value="9">Altri</option>
    </select> 
    <button type="button" onclick="calcolo()">Calcola i nuovi ranking</button>

    <p style="background-color:powderblue;" id="demo1"></p>
    <p style="background-color:powderblue;" id="demo2"></p>

<script>
    function calcolo(){

        var selezioners1 = document.getElementById("rankingS1").value;
        var selezioners2 = document.getElementById("rankingS2").value;
        var selezionerisultato = document.getElementById("risultato");
        var testorisultato = selezionerisultato.options[selezionerisultato.selectedIndex].text;
        var selezionecompetizione = document.getElementById("competizione");
        var testocompetizione = selezionecompetizione.options[selezionecompetizione.selectedIndex].value;

        function cdf(x) {
            var x = x;
            var t = 1 / (1 + .2315419 * Math.abs(x));
            var d =.3989423 * Math.exp( -x * x / 2);
            var prob = d * t * (.3193815 + t * ( -.3565638 + t * (1.781478 + t * (-1.821256 + t * 1.330274))));
            if( x > 0 ) prob = 1 - prob;
            return prob;
        }

        var R1 = 2;
		var R2 = 1.5;
		var R3 = 1;
		var R4 = -1;
		var R5 = -1.5;
		var R6 = -2;

        var delta = (8*(selezioners1 - selezioners2))/1000;

        var C1 = -1.060;
		var C2 = -0.394;
		var C3 = 0;
		var C4 = 0.394;
		var C5 = 1.060;

        var P1 = cdf(C1 + delta);
		var P2 = cdf(C2 + delta) - cdf(C1 + delta);
		var P3 = cdf(C3 + delta) - cdf(C2 + delta);
		var P4 = cdf(C4 + delta) - cdf(C3 + delta);
		var P5 = cdf(C5 + delta) - cdf(C4 + delta);
		var P6 = 1 - cdf(C5 + delta);

        var EMR = Math.round((P1*R1 + P2*R2 + P3*R3 + P4*R4 + P5*R5 + P6*R6)*100.0)/100.0;
        var SSV = 0;

        switch(testorisultato) {
		
		case "3-0":
			SSV = R1;
			break;
		
		case "3-1":
			SSV = R2;
			break;
		
		case "3-2":
			SSV = R3;
			break;
		
		case "2-3":
			SSV = R4;
			break;
		
		case "1-3":
			SSV = R5;
			break;
		
		case "0-3":
			SSV = R6;
			break;
		
		}

        var MWF = 0;

        switch(testocompetizione) {
		
		case "1":
			MWF = 50;
			break;
		
		case "2":
			MWF = 45;
			break;
		
		case "3":
			MWF = 40;
			break;
			
		case "4":
			MWF = 35;
			break;
		
		case "5":
			MWF = 35;
			break;
		
		case "6":
			MWF = 35;
			break;
		
		case "7":
			MWF = 20;
			break;
		
		case "9":
			MWF = 10;
			break;
		
		case "8":
			MWF = 17.5;
			break;
		
		}

        var differenza = Math.round((MWF*(SSV - EMR))/8*100.0)/100.0;
        var NP1 = 0;
        var NP2 = 0;

        if (SSV > 0) {
			if (differenza > 0) {
				NP1 = parseInt(selezioners1) + differenza;
				NP2 = parseInt(selezioners2) - differenza;
			} else {
				NP1 = parseInt(selezioners1) + 0.01;
				NP2 = parseInt(selezioners2) - 0.01;
			}
		}
		
		if (SSV < 0) {
			if (differenza < 0) {
				NP1 = parseInt(selezioners1) + differenza;
				NP2 = parseInt(selezioners2) - differenza;
			} else {
				NP1 = parseInt(selezioners1) - 0.01;
				NP2 = parseInt(selezioners2) + 0.01;
			}
		}

        let text1 = "Il nuovo ranking della squadra 1 è ";
        let text2 = "Il nuovo ranking della squadra 2 è ";
	    
	if (NP1 < 0){
		NP1 = 0;
	}
	
	if (NP2 < 0){
		NP2 = 0;
	}
	    
	NP1 = Math.round(NP1*100.0)/100.0;
	NP2 = Math.round(NP2*100.0)/100.0;

        document.getElementById("demo1").innerHTML = text1 + NP1.toFixed(2);
        document.getElementById("demo2").innerHTML = text2 + NP2.toFixed(2);

    }
</script>

</form>
</body>
